<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281527777.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281527777.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281527777.png">
  <link rel="mask-icon" href="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281527777.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mooyi646.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="Live with fun">
<meta property="og:type" content="website">
<meta property="og:title" content="Mooyi&#39;s Blog">
<meta property="og:url" content="https://mooyi646.github.io/index.html">
<meta property="og:site_name" content="Mooyi&#39;s Blog">
<meta property="og:description" content="Live with fun">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Mooyi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://mooyi646.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Mooyi's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Mooyi's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/f293a03a.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/f293a03a.html" class="post-title-link" itemprop="url">LLM开发学习</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-31 17:50:40" itemprop="dateCreated datePublished" datetime="2024-01-31T17:50:40+08:00">2024-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-01 14:22:25" itemprop="dateModified" datetime="2024-02-01T14:22:25+08:00">2024-02-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/f293a03a.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/f293a03a.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="大模型如何完成工作？"><a href="#大模型如何完成工作？" class="headerlink" title="大模型如何完成工作？"></a>大模型如何完成工作？</h1><h2 id="内在模型与提示词"><a href="#内在模型与提示词" class="headerlink" title="内在模型与提示词"></a>内在模型与提示词</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/post/f293a03a.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/b32394ab.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/b32394ab.html" class="post-title-link" itemprop="url">向量数据库的非必要性</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-01-31 17:50:40 / Modified: 17:54:08" itemprop="dateCreated datePublished" datetime="2024-01-31T17:50:40+08:00">2024-01-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/b32394ab.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/b32394ab.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="向量数据库的非必要性"><a href="#向量数据库的非必要性" class="headerlink" title="向量数据库的非必要性"></a>向量数据库的非必要性</h1><p>检索增强RAG（Retrieval Augmented Generation)</p>
<ol>
<li>快速在全部潜在文档中搜索一小部分相关文档<ul>
<li>确定相关文档子集：向量嵌入，最邻近搜索</li>
</ul>
</li>
<li>将这部分文档内容加入到模型的提示信息中，再将其发送给LLM</li>
</ol>
<p>向量数据库：存储和计算大量文档的最近邻信息</p>
<p>向量数据库问题：</p>
<ul>
<li>数据一致性</li>
<li>有限的查询语言</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/post/b32394ab.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/a3856614.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/a3856614.html" class="post-title-link" itemprop="url">LLM Agent</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-31 17:08:12" itemprop="dateCreated datePublished" datetime="2024-01-31T17:08:12+08:00">2024-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-01 14:22:46" itemprop="dateModified" datetime="2024-02-01T14:22:46+08:00">2024-02-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/a3856614.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/a3856614.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Agent功能：给定既有目标或复杂任务，让机器自己去思考如何分解完成，整个过程无需人类参与。是一种高度主动的自主行为。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/post/a3856614.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/0.html" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-18 11:09:27" itemprop="dateCreated datePublished" datetime="2024-01-18T11:09:27+08:00">2024-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 17:54:08" itemprop="dateModified" datetime="2024-01-31T17:54:08+08:00">2024-01-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/0.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>348</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>结构化数据 vs. 非结构化数据</strong></p>
<ul>
<li>结构化数据：也称行数据。由二维表结构来逻辑表达和实现，严格遵循数据格式与长度规范，主要通过关系型数据库进行存储管理</li>
<li>非结构化数据：数据结构不规则或不完整，没有预定义的数据模型，不方便用数据库二维表来表现的数据。例如办公文档、文本、图片、HTML、音视频等等。</li>
</ul>
<p><strong>Relation Extraction(RE)</strong></p>
<p>关系提取。</p>
<p>作用：从非结构化文本中提取结构化知识。</p>
<p><strong>prompt-tuning</strong></p>
<p>提示调整？</p>
<p>通过完成掐词任务，直接采用预训练的 LM 作为预测器，以弥补预训练和微调之间的差距。</p>
<p>prompt-tuning将原始输入与提示模板结合在一起来预测[MASK]，然后将预测的标签词映射到相应的类集，使得PLMs(Pre-trained Language Models)在少量任务上有更好的表现。</p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/0.html" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-17 13:51:39" itemprop="dateCreated datePublished" datetime="2024-01-17T13:51:39+08:00">2024-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 17:54:08" itemprop="dateModified" datetime="2024-01-31T17:54:08+08:00">2024-01-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/0.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SseEmmitter"><a href="#SseEmmitter" class="headerlink" title="SseEmmitter"></a>SseEmmitter</h2><p>作用：推送消息</p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>服务端常用推送消息的技术有：</p>
<ul>
<li><p>客户端轮询：ajax定时拉取</p>
</li>
<li><p>服务端主动推送：WebSocket。</p>
<ul>
<li>是<strong>双全工</strong>的(full deplex)，即可以同时进行信号的双向传输。</li>
<li>本质上是一个额外的tcp连接，建立与关闭时握手使用http协议，其他数据传输不使用http协议，而是更复杂一些，适用于需要进行复杂<strong>双向</strong>数据通讯的场景。</li>
<li>优点：强大灵活</li>
</ul>
</li>
<li><p>服务端主动推送：SSE(Server Send Event)。</p>
<ul>
<li><p>基于单工通信模式，HTML5新标准，用来从服务端实时推送数据到浏览器端。</p>
</li>
<li><p>直接建立在当前http连接上，本质是保持一个http长连接。</p>
<p>注：http协议无法做到服务器主动推送消息。但是，可以变通为服务器向客户端声明，接下来发送的是流信息(streaming)，即发送的为数据流，会源源不断发送，如此，客户端不会关闭连接，会一直等着服务器发过来的新的数据流。（流信息本质为用时很长的下载）</p>
</li>
</ul>
</li>
</ul>
<p>SSE优点：</p>
<ul>
<li><p>使用HTTP协议，现有服务器软件都支持。WebSocket是一个独立协议。</p>
</li>
<li><p>轻量级，使用简单。</p>
</li>
<li><p>默认支持断线重连，WebSocket需要自己实现。</p>
</li>
<li><p>一般只用于传送文本，二进制数据需要编码后传送。WebSocket默认支持传送二进制数据。</p>
</li>
<li><p>支持自定义发送的消息类型。</p>
</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>大致使用步骤为：</p>
<ol>
<li>客户端创建SseEmitter，即<code>EventSource</code>对象，向服务器发起连接</li>
<li>服务端存储客户端创建的SseEmitter</li>
</ol>
<h4 id="客户端API"><a href="#客户端API" class="headerlink" title="客户端API"></a>客户端API</h4><p><strong>1. EventSource对象</strong></p>
<p>SSE客户端API部署在EventSource对象中，查看浏览器是否支持SSE：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;EventSource&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用SSE：</p>
<ol>
<li><p>浏览器生成EventSource实例，向服务器发起连接：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = <span class="keyword">new</span> <span class="title class_">EventSource</span>(url);</span><br></pre></td></tr></table></figure>

<p>其中，以上url可以与当前网址同域，也可以跨域。</p>
<p>跨域时：可以指定第二个参数，打开<code>withCredentials</code>属性，表示是否一起发送Cookie.即为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = <span class="keyword">new</span> <span class="title class_">EventSource</span>(url, &#123; <span class="attr">withCredentials</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>EventSource实例的<code>readyState</code>属性，表示连接的当前状态，该属性<strong>只读</strong>，可取值如下：</p>
<ul>
<li>0：相当于常量<code>EventSource.CONNECTING</code>，表示连接还未建立，或者断线正在重连。</li>
<li>1：相当于常量<code>EventSource.OPEN</code>，表示连接已经建立，可以接受数据。</li>
<li>2：相当于常量<code>EventSource.CLOSED</code>，表示连接已断，且不会重连。</li>
</ul>
</li>
<li><p>连接一旦建立，就会触发<code>open</code>事件，可以在<code>onopen</code>属性定义回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">source.<span class="property">onopen</span> =  <span class="keyword">function</span> (<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">source.<span class="title function_">addEventListener</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端收到服务器发来的数据，会触发<code>message</code>事件，可以在<code>onmessage</code>属性定义回调函数，类似于onopen.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">source.<span class="property">onmessage</span> =  <span class="keyword">function</span> (<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">source.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>其中，data即为服务器传回的数据（文本格式）</p>
</li>
<li><p>发生通信错误时，会触发<code>error</code>事件，可以在<code>onerror</code>属性中定义回调函数。</p>
</li>
<li><p>使用<code>close</code>方法关闭SSE连接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义事件的处理：</p>
<p>服务器发来的数据默认总是触发浏览器EventSource的message事件，也可以自定义SSE事件，如此，发送来的数据不会触发message事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source.<span class="title function_">addEventListener</span>(<span class="string">&#x27;event_name&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>以上，浏览器对SSE的’event_name’事件监听，而服务器如何发送’event_name’事件呢？如下：</p>
</li>
</ol>
<h4 id="服务器实现"><a href="#服务器实现" class="headerlink" title="服务器实现"></a>服务器实现</h4><p><strong>数据格式</strong>：</p>
<ol>
<li><p>必须是UTF8编码的文本</p>
</li>
<li><p>有如下HTTP头信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: text/event-stream</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>Content-Type<code>必须指定 MIME 类型为</code>event-steam</p>
</li>
</ol>
<ul>
<li><p>每次发送的信息，由若干个<code>message</code>组成，每个之间使用<code>\n\n</code>分隔。每个message内部都由若干行组成，每行格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[field]: value\n</span><br></pre></td></tr></table></figure>

</li>
<li><p>field取值可以有四个：</p>
<ul>
<li><p><strong>data</strong>：表示数据内容，可以分行，每行以<code>\n</code>结尾，最后一行使用<code>\n\n</code>结尾</p>
</li>
<li><p><strong>event</strong>：表示自定义的事件类型，默认是<code>message</code>事件。</p>
</li>
<li><p><strong>id</strong>：表示数据标识符，相当于每条数据的编号。</p>
<ul>
<li>在浏览器中，使用<code>lastEventId</code>属性读取这个值。</li>
<li>断连时，浏览器会发送一个HTTP头，其中包含一个特殊的<code>Last-Event-ID</code>头信息，将该值发送回来，用于帮助服务器端重新建立连接。</li>
<li>因此，该头信息可被视为一种同步机制。</li>
</ul>
</li>
<li><p><strong>retry</strong>：表示浏览器重新发起连接的时间间隔。</p>
<p>浏览器重新发起连接的两种情况：</p>
<ul>
<li>时间间隔到期</li>
<li>网络错误等原因导致连接出错</li>
</ul>
</li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id: msg1\n</span><br><span class="line">event: foo\n</span><br><span class="line">retry: 10000\n</span><br><span class="line">data: a foo event\n\n</span><br></pre></td></tr></table></figure>


</li>
<li><p>此外，还可以有冒号开头的行，表示注释。通常，服务器每隔一段时间就会向浏览器发送一个注释，<strong>保持连接不中断</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">: <span class="title class_">This</span> is a comment</span><br></pre></td></tr></table></figure></li>
</ul>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html">Server-Sent Events 教程</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011943534/article/details/120251614">springboot学习(五十八) springboot中使用SseEmitter推送消息</a></p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/ba778c11.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/ba778c11.html" class="post-title-link" itemprop="url">LangChain</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-16 15:06:03" itemprop="dateCreated datePublished" datetime="2024-01-16T15:06:03+08:00">2024-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-01 14:22:46" itemprop="dateModified" datetime="2024-02-01T14:22:46+08:00">2024-02-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LLM/" itemprop="url" rel="index"><span itemprop="name">LLM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/ba778c11.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/ba778c11.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="LangChain"><a href="#LangChain" class="headerlink" title="LangChain"></a>LangChain</h1><p>作用：用于开发由语言模型驱动的应用程序的框架。</p>
<p>主要能力：</p>
<ul>
<li>可以将LLM模型与外部数据源进行连接</li>
<li>允许与LLM模型进行交互</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/post/ba778c11.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/0.html" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-10 11:44:16" itemprop="dateCreated datePublished" datetime="2024-01-10T11:44:16+08:00">2024-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 17:54:08" itemprop="dateModified" datetime="2024-01-31T17:54:08+08:00">2024-01-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/0.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><p>【MYSQL锁】</p>
<h2 id="按粒度"><a href="#按粒度" class="headerlink" title="按粒度"></a>按粒度</h2><h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><p><strong>定义</strong>：即对整个数据库实例加锁</p>
<p><strong>应用场景</strong>：全库逻辑备份(<code>mysqldump</code>)</p>
<p><strong>实现方式</strong>：mysql提供了全局加<strong>读锁</strong>的方法，<code>FLUSH TABLES WITH RED LOCK</code>(FTWRL),，当需要整个库处于<strong>只读</strong>状态时，可以使用以上命令。使用后其他线程的更新类语句会被阻塞。</p>
<p><strong>风险点：</strong></p>
<ul>
<li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就能停止。</li>
<li>如果在从库上备份，那么备份期间从库不能执行主库同步过来的binlog，会导致主从延迟。</li>
</ul>
<p><strong>解决办法：</strong></p>
<ul>
<li><code>mysqldump</code>使用参数<code>--single-transaction</code>，启动一个事务，确保拿到一致性视图。而由于MVCC的支持，这个过程中数据是可以正常更新的。【需要支持事务】</li>
</ul>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><p><strong>定义</strong>：即对当前操作的整张表加锁。MyISAM与InnoDB都支持表级锁。</p>
<p>MYSQL中有两种表级锁：</p>
<ol>
<li>表锁</li>
<li>元数据锁(Meta Data Lock， MDL)</li>
</ol>
<h4 id="1-表锁"><a href="#1-表锁" class="headerlink" title="1. 表锁"></a>1. 表锁</h4><p><strong>实现方式</strong>：<code>lock table table_name read/write</code></p>
<p>如：<code>lock table t1 read , t2 wirte</code>，则其他线程写t1，读写t2都会被阻塞。</p>
<p>同时，本线程在<code>unlock tables</code>之前，只允许执行读t1，读写t2的操作，且不能访问其他表。</p>
<p><strong>释放锁</strong></p>
<ol>
<li><code>unlock tables</code></li>
<li>会话退出后会释放所有表锁。</li>
</ol>
<h4 id="2-元数据锁MDL"><a href="#2-元数据锁MDL" class="headerlink" title="2. 元数据锁MDL"></a>2. 元数据锁MDL</h4><p>MDL不需要显式使用，在访问一个表时会被自动加上。</p>
<ul>
<li>当对一个表做增删改查(CRUD)操作的时候，加 <strong>MDL读锁</strong>(Shared Read &#x2F;  Shared Write)；</li>
<li>当要对表做结构变更操作的时候，加 <strong>MDL 写锁</strong>。</li>
</ul>
<p>作用：防止进行CRUD操作时，其他线程对表结构做变更。</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/keme/p/11065025.html#221-%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E4%BA%86%E8%BF%99%E4%B8%AAmdl%E9%94%81">风险点：</a></strong></p>
<p>如对表进行以下操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">注: 表t 是 innodb 表，mysql版本是<span class="number">5.7</span><span class="number">.24</span> 自动提交开启</span><br><span class="line"><span class="number">1.</span> sessionA:</span><br><span class="line"># <span class="keyword">begin</span>显式开启事务，所以其不会autocommit</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t limit <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> sessionB:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t limit <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> sessionC:</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t <span class="keyword">add</span> f <span class="type">int</span> ;</span><br><span class="line">#会mdl锁住</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> sessionD:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>如上操作：</p>
<ol>
<li><p>A先启动，会对表t加上一个MDL读锁</p>
</li>
<li><p>然后B也需要MDL读锁，正常执行。</p>
</li>
<li><p>C为对表进行结构修改，需要获取MDL写锁，但是A获取的MDL读锁还未释放，所以C获取锁失败，被阻塞。</p>
<blockquote>
<p>Q：为什么A获取的MDL读锁还未释放？</p>
<p>A：事务中的 MDL 锁，在语句执行开始时申请，但是语句结束后并不会马上释放，而会<strong>等到整个事务提交后再释放。</strong> </p>
<p>一般行锁都有锁超时时间。但是MDL锁没有超时时间的限制，只要事务没有提交就会一直锁住。</p>
</blockquote>
</li>
<li><p>之后所有在表t上申请读锁的操作都会被C阻塞。</p>
<blockquote>
<p>Q：为什么？</p>
<p>A：所有对表的增删改查操作都需要先申请MDL 读锁，而这时读锁没有释放，对表alter ，产生了mdl写锁，所有锁会形成一个优先级队列，<strong>写锁优先级高于读锁</strong>，所以一旦出现写锁等待，会将后续所有读写操作都阻塞。</p>
</blockquote>
</li>
</ol>
<p><strong>结果</strong>：很容易造成线程爆满</p>
<p><strong>解决办法：</strong></p>
<p>由前面分析可得，产生如上风险的原因是有<strong>长事务</strong>一直未提交，所以造成<strong>锁未释放</strong>。</p>
<p>Q：如何找到长事务？</p>
<p>A：在MySQL的<code>information_schema</code>库的<code>innobd_trx</code>表中，可以查到当前执行中的事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查看事务超过<span class="number">60</span>s的事务</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.innodb_trx <span class="keyword">where</span> TIME_TO_SEC(timediff(now(),trx_started))<span class="operator">&gt;</span><span class="number">60</span>\G;</span><br><span class="line"># trx_started 表示什么时候执行的这个事务</span><br></pre></td></tr></table></figure>

<p>该命令会返回一系列信息，包括：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 事务状态</span><br><span class="line">trx_state：<span class="keyword">RUNNING</span></span><br><span class="line"># 事务开始时间</span><br><span class="line">trx_started: <span class="number">2019</span><span class="number">-06</span><span class="number">-21</span> <span class="number">12</span>:<span class="number">44</span>:<span class="number">22</span></span><br><span class="line"># 执行事务的线程id</span><br><span class="line">trx_mysql_thread_id: <span class="number">17</span></span><br><span class="line"></span><br><span class="line"># 然后通过线程id定位</span><br><span class="line"># 查看所有线程</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">full</span> processlist;</span><br></pre></td></tr></table></figure>

<p>【以上操作】</p>
<p>先查看host字段，查看到底是谁连接了数据库，然后进去commit（提交事务）或者rollback ,哪如果不是localhost 环境，是程序连接了，这时候就要kill掉了。</p>
<p>即整体解决方案为：</p>
<ol>
<li>找到长事务</li>
<li>若做DDL(data definition language)的表刚好有长事务在执行，暂停DDL或者kill掉这个长事务</li>
</ol>
<p>即我们为什么建议在低峰期做ddl变更。</p>
<h4 id="3-意向锁"><a href="#3-意向锁" class="headerlink" title="3. 意向锁"></a>3. 意向锁</h4><p>定义：意向锁为一种<strong>不与行级锁冲突的表级锁</strong>。</p>
<ul>
<li>意向共享锁(Intention Shared Lock, IS)：一个事务在获取（任何一行&#x2F;或者全表）S锁之前，一定会先在所在的表上加IS锁。</li>
<li>意向排他锁(Intention Exclusive Lock, IX)：一个事务在获取（任何一行&#x2F;或者全表）X锁之前，一定会先在所在的表上加IX锁。</li>
</ul>
<p><strong>意向锁是表级锁，不会与行级锁发生冲突，意向锁之间也不会发生冲突。其只会和共享表锁(lock table … read)以及独占表锁(lock table… write)发生冲突。</strong></p>
<p>表锁与行锁满足：读读共享、读写互斥、写写互斥。</p>
<p><strong>意向锁作用</strong>：</p>
<ul>
<li>无<code>意向锁</code>，需要加<code>独占表锁</code>时：遍历表中所有记录查询是否有<code>独占锁</code>，效率低；</li>
<li>有<code>意向锁</code>，则加<code>独占锁</code>之前会先加表级别的<code>意向独占锁</code>，则加<code>独占表锁</code>时，可以直接查看是否有<code>意向独占锁</code>从而判断是否有锁冲突。</li>
</ul>
<p>即意向锁的作用为：<strong>快速判断表中是否有记录被加锁。</strong></p>
<h4 id="4-AUTO-INC-锁"><a href="#4-AUTO-INC-锁" class="headerlink" title="4. AUTO-INC 锁"></a>4. AUTO-INC 锁</h4><p>表中主键通过<code>AUTO_INCREMENT</code>设置为自增，之后插入数据时，可以不指定主键的值，数据库会自动给其赋递增的值，这主要通过<code>AUTO-INC锁</code>实现。</p>
<p>AUTO-INC锁是一个特殊的表锁机制。锁<strong>不是等事务提交后才释放，而是执行完插入语句后就立即释放。</strong></p>
<p>执行过程：</p>
<ol>
<li>在插入数据时，会加一个表级别的 AUTO-INC 锁</li>
<li>然后为被 <code>AUTO_INCREMENT</code> 修饰的字段赋值递增的值</li>
<li>等插入语句执行完成后，才会把 AUTO-INC 锁释放掉。</li>
</ol>
<p>那么，一个事务在持有 AUTO-INC 锁的过程中，其他事务的如果要向该表插入语句都会被阻塞，从而保证插入数据时，被 <code>AUTO_INCREMENT</code> 修饰的字段的值是连续递增的。</p>
<p>面对大量插入语句时：性能低。</p>
<p> 在 MySQL 5.1.22 版本开始，InnoDB 存储引擎提供了一种<strong>轻量级的锁</strong>来实现自增。</p>
<p>一样也是在插入数据的时候，会为被 <code>AUTO_INCREMENT</code> 修饰的字段加上轻量级锁，<strong>然后给该字段赋值一个自增的值，就把这个轻量级锁释放了，而不需要等待整个插入语句执行完后才释放锁</strong>。</p>
<p>用AUTO-INC还是轻量级锁：<code>innodb_autoinc_lock_mode</code>：</p>
<ul>
<li><p>值为0：AUTO-INC</p>
</li>
<li><p>值为2：轻量级锁</p>
<blockquote>
<p>效率最高</p>
<p>但是搭配binlog的日志格式为statement一起使用时，在<a target="_blank" rel="noopener" href="https://xiaolincoding.com/mysql/lock/mysql_lock.html#auto-inc-%E9%94%81">主从复制中会发生数据不一致</a>情况。</p>
</blockquote>
</li>
<li><p>值为1：</p>
<ul>
<li>普通insert语句，自增锁在申请之后就马上释放</li>
<li>insert … select这种批量插入语句，自增锁等语句结束后释放。</li>
</ul>
</li>
</ul>
<h3 id="页级锁"><a href="#页级锁" class="headerlink" title="页级锁"></a>页级锁</h3><p><strong>定义</strong>：介于行级锁与表锁之间。</p>
<p>表锁：速度快，冲突多。</p>
<p>行锁：冲突少，速度慢。</p>
<p>所以采取折中的页级锁，一次取相邻的一组记录。</p>
<p><a target="_blank" rel="noopener" href="https://www.mysqlzh.com/doc/218.html">BDB</a> 引擎支持页级锁。</p>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p><strong>定义</strong>：对某一行数据进行加锁。</p>
<p>粒度最小的锁，发生冲突的概率最低，并发度最高。但是加锁慢，开销大，容易死锁。</p>
<p>MYSQL中只有InnoDB支持行级锁，行级锁分为共享锁和排他锁。</p>
<p><strong>实现方式</strong>：行级锁不是直接锁记录，而是<strong>锁索引</strong>。</p>
<ul>
<li>主键索引：直接锁定主键索引</li>
<li>非主键索引：先锁定该非主键索引，再锁定相关的主键索引。</li>
</ul>
<p><strong>Q1</strong>：普通<code>select</code>语句会对记录加锁吗？</p>
<p><strong>A1</strong>：不会，其属于<code>快照读</code>（MVCC实现）</p>
<p><strong>Q2</strong>：查询时需要加锁怎么办？</p>
<p><strong>A2</strong>：使用以下两种方式，即锁定读</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>对读取的记录加共享锁</span><br><span class="line"><span class="keyword">select</span> ... lock <span class="keyword">in</span> share mode;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>对读取的记录加独占锁</span><br><span class="line"><span class="keyword">select</span> ... <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>

<p>以上语句使用时需在同一个事务中，因为事务提交后锁就会释放。</p>
<p><strong>Q3</strong>：怎么保证在同一事务中？</p>
<p><strong>A3</strong>：使用<code>begin</code>， <code>start transaction</code>或<code>set autocommit = 0 </code>显式开启事务</p>
<p>锁分类（按属性）：【读读共享、读写互斥、写写互斥】</p>
<ul>
<li>共享锁（S锁）</li>
<li>排他锁（X锁）</li>
</ul>
<p><strong>行级锁类型主要三类：</strong></p>
<ol>
<li>Record Lock，记录锁，锁一条记录</li>
<li>Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身</li>
<li>Next-Key Lock，临键锁，Record Lock + Gap Lock，锁定一个范围以及记录本身</li>
</ol>
<h4 id="Record-Lock记录锁"><a href="#Record-Lock记录锁" class="headerlink" title="Record Lock记录锁"></a>Record Lock记录锁</h4><p>锁住一条记录，记录锁有S锁与X锁之分。</p>
<p>如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 开启事务</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"># 给t1表中id <span class="operator">=</span>  <span class="number">1</span>的记录加上X型的记录锁</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>



<h4 id="Gap-Lock间隙锁"><a href="#Gap-Lock间隙锁" class="headerlink" title="Gap Lock间隙锁"></a>Gap Lock间隙锁</h4><p><strong>只存在与可重复读(RR)级别</strong>。</p>
<p>目的：解决可重复读隔离级别下<strong>幻读</strong>的现象。即防止插入幻读记录。</p>
<p>如：id有3， 5的记录，在(3, 5)加上间隙锁，则其他事务无法插入id &#x3D; 4的记录，防止了幻读的发生。</p>
<p>间隙锁虽然存在S锁与X锁，但是并无区别。间隙锁是<strong>兼容</strong>的，<strong>即两个事务可以同时持有包含共同间隙范围的间隙锁，并不存在互斥关系</strong>，因为间隙锁的目的是防止插入幻影记录而提出的。</p>
<h4 id="Next-Key-Lock临键锁"><a href="#Next-Key-Lock临键锁" class="headerlink" title="Next-Key Lock临键锁"></a>Next-Key Lock临键锁</h4><p>锁定一个范围，并且锁定记录本身。</p>
<p>如：id有3， 5的记录，在(3, 5]加上间隙锁，则其他事务无法插入id &#x3D; 4的记录，也无法修改id &#x3D; 5的记录。</p>
<p>所以，next-key lock的<strong>作用</strong>为：即保护了记录，又能组织其他事务将新纪录插入到被保护记录的前方的间隙中。</p>
<p>由于next-key lock包含记录锁，所以依然满足S锁与X锁的特性。即一个事务获取了 X 型的 next-key lock，那么另外一个事务在获取相同范围的 X 型的 next-key lock 时，是会被阻塞的。</p>
<h4 id="插入意向锁"><a href="#插入意向锁" class="headerlink" title="插入意向锁"></a>插入意向锁</h4><p>事务插入记录时，需判断：插入位置是否已被其他事务加了间隙锁，若有，则需等待锁释放，在此期间，会生成一个<strong>插入意向锁</strong>，表明事务想要在某个区间插入新纪录，但是现在处于等待状态。</p>
<blockquote>
<p>注：MySQL 加锁时，是先生成锁结构，然后设置锁的状态，如果锁状态是等待状态，并不是意味着事务成功获取到了锁，只有当锁状态为正常状态时，才代表事务成功获取到了锁</p>
</blockquote>
<p>插入意向锁属于<strong>特殊的间隙锁</strong>，普通间隙锁锁住的为一个区间，插入意向锁锁住的就是一个点。</p>
<p>尽管「插入意向锁」也属于间隙锁，但两个事务却不能在同一时间内，一个拥有间隙锁，另一个拥有该间隙区间内的插入意向锁（当然，插入意向锁如果不在间隙锁区间内则是可以的）。</p>
<h3 id="select语句的锁定范围"><a href="#select语句的锁定范围" class="headerlink" title="select语句的锁定范围"></a>select语句的锁定范围</h3><h4 id="普通select：select-from-t1-where-id-x3D-1"><a href="#普通select：select-from-t1-where-id-x3D-1" class="headerlink" title="普通select：select * from t1 where id &#x3D; 1"></a>普通select：select * from t1 where id &#x3D; 1</h4><p>普通select查询为快照读，其通过MVCC实现无锁查询，InnoDB不会为其加任何锁。</p>
<p><strong>Q</strong>：什么锁都没有？</p>
<p><strong>A</strong>：前面提到，InnoDB不会为其加任何锁，即不会存在行锁，但是对数据表进行DML和DDL操作时，MySQL会为该表加上MDL锁，<strong>MDL锁是sever层实现的表级锁</strong>，适用于所有存储引擎。所以：</p>
<ul>
<li>对表进行增删改查(DML)，加MDL读锁(Shared Read与Shared Write都属于MDL读锁，互相兼容)</li>
<li>对表进行结构更改(DDL)，加MDL写锁</li>
</ul>
<p>因此，我们所说的普通查询不加锁，指的是不加行级锁，实际上持有MDL锁。</p>
<h4 id="select-for-update"><a href="#select-for-update" class="headerlink" title="select .. for update"></a>select .. for update</h4><p>属于锁定语句，会对表记录加X型的行级锁。对于不同隔离级别，其加的行级锁种类不同。</p>
<p><strong>1. RC读已提交</strong></p>
<p>行级锁种类只有记录锁。</p>
<p><strong>2. RR可重复读</strong></p>
<p>行级锁种类除记录锁外还有间隙锁与临键锁，不同场景下加锁不同。</p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/0.html" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-07 13:54:47" itemprop="dateCreated datePublished" datetime="2024-01-07T13:54:47+08:00">2024-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 17:54:08" itemprop="dateModified" datetime="2024-01-31T17:54:08+08:00">2024-01-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/0.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>7.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>7 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="三大日志binlog-redo-log-undo-log"><a href="#三大日志binlog-redo-log-undo-log" class="headerlink" title="三大日志binlog, redo log, undo log"></a>三大日志binlog, redo log, undo log</h1><img src="https://oss.javaguide.cn/github/javaguide/01.png" alt="img" style="zoom:50%;" />

<h2 id="redo-log重做日志"><a href="#redo-log重做日志" class="headerlink" title="redo log重做日志"></a>redo log重做日志</h2><p>作用：使MySQL拥有崩溃恢复能力。是InnoDB独有的。</p>
<p>更新表数据时，在buffer pool存在要更新的数据时，直接在Buffer Pool更新数据所在页，然后将其设置为脏页。</p>
<p>然后将“在某个数据页做了什么修改”记录到redo log buffer中，接着刷盘到redo log文件中。是物理日志。</p>
<blockquote>
<p>每条 redo 记录由“<strong>表空间号+数据页号+偏移量+修改数据长度+具体修改的数据</strong>”组成</p>
</blockquote>
<p><img src="https://oss.javaguide.cn/github/javaguide/03.png" alt="img"></p>
<h3 id="Buffer-Pool"><a href="#Buffer-Pool" class="headerlink" title="Buffer Pool"></a>Buffer Pool</h3><p><strong>Q: Why Buffer Pool?</strong></p>
<p><strong>A</strong>：以通常思维来看数据修改。</p>
<ol>
<li>从磁盘中读取记录</li>
<li>在内存中修改该记录</li>
</ol>
<p>修改结束后，该条记录是直接写回磁盘，还是缓存起来呢？</p>
<p>A：缓存起来。以便下次查询命中了该记录，可以直接读取缓存中的记录，无需从磁盘读。 - &gt; Buffer Pool</p>
<p><strong>Q：Buffer Pool缓存什么？</strong></p>
<p>InnoDB存储数据以页为单位，默认页大小为16k.</p>
<p>Buffer Pool同理，以页划分。</p>
<p>在 MySQL 启动的时候，<strong>InnoDB 会为 Buffer Pool 申请一片连续的内存空间，然后按照默认的<code>16KB</code>的大小划分出一个个的页， Buffer Pool 中的页就叫做缓存页</strong>。此时这些缓存页都是空闲的，之后随着程序的运行，才会有磁盘上的页被缓存到 Buffer Pool 中。</p>
<p>所以，MySQL 刚启动的时候，使用的虚拟内存空间很大，而使用到的物理内存空间却很小，这是因为只有这些虚拟内存被访问后，操作系统才会触发缺页中断，申请物理内存，接着将虚拟地址和物理地址建立映射关系。</p>
<p>【小林BufferPool<a target="_blank" rel="noopener" href="https://xiaolincoding.com/mysql/log/how_update.html#buffer-pool-%E7%BC%93%E5%AD%98%E4%BB%80%E4%B9%88%E3%80%91">https://xiaolincoding.com/mysql/log/how_update.html#buffer-pool-%E7%BC%93%E5%AD%98%E4%BB%80%E4%B9%88】</a></p>
<h3 id="刷盘时机"><a href="#刷盘时机" class="headerlink" title="刷盘时机"></a>刷盘时机</h3><p>刷盘目的：保证数据持久性与一致性。【顺序写】</p>
<p><strong>1. 事务提交</strong></p>
<p>事务提交时，log buffer中的redo log会被刷新到磁盘。</p>
<p>可以通过<code>innodb_flush_log_at_trx_commit</code>参数控制。</p>
<p><strong>2. log buffer空间不足时</strong></p>
<p>log buffer中redo log已占满总容量的一半左右，会刷盘。</p>
<p><strong>3. 事务日志缓冲区满</strong></p>
<p>InnoDB 使用一个事务日志缓冲区（transaction log buffer）来暂存事务的重做日志条目。当缓冲区满时，会触发日志的刷新，将日志写入磁盘。</p>
<p><strong>4. CheckPoint检查点</strong></p>
<p>InnoDB定时执行checkpoint操作，将内存中的脏数据刷新到磁盘，同时将响应的redo log一起刷新，以保证数据一致性。</p>
<p><strong>5. 后台刷新线程</strong></p>
<p>InnoDB启动了后台线程，周期性地（1s）将Buffer Pool中的脏页刷新到磁盘（WAL Write-Ahead Logging，预写日志，即写操作并不是立刻写到磁盘上，而是先写日志，然后在合适的时间再写到磁盘上），并将相关redo log一起刷新。</p>
<p><strong>6. 正常关闭服务器</strong></p>
<p>MySQL关闭时，redo log会刷盘。</p>
<h3 id="刷盘策略innodb-flush-log-at-trx-commit"><a href="#刷盘策略innodb-flush-log-at-trx-commit" class="headerlink" title="刷盘策略innodb_flush_log_at_trx_commit"></a>刷盘策略innodb_flush_log_at_trx_commit</h3><p><code>innodb_flush_log_at_trx_commit</code>取值：</p>
<ul>
<li><p><strong>0</strong>：每次事务提交时不进行刷盘操作。【后台线程1s刷】</p>
<p>性能最高，但最不安全。MySQL挂了或宕机可能丢失最近1s的事务。</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/06.png" alt="img"></p>
</li>
<li><p><strong>1</strong>：每次事务提交时都进行刷盘操作。</p>
<p>性能最低，但是最安全。不会有数据丢失。【为保证事务一致性，需使用1】</p>
<p><img src="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202401071355264.png" alt="img"></p>
</li>
<li><p><strong>2</strong>：每次事务提交时，只把log buffer中的redo log写入page cache（操作系统的文件系统缓存）。</p>
<p>性能与安全性都介于以上两种之间。MySQL挂了不会丢数据，操作系统宕机或断点可能丢1s.</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/09.png" alt="img"></p>
</li>
</ul>
<p>默认值：1</p>
<p>此外，<code>InnoDB</code> 存储引擎有一个后台线程，每隔<code>1</code> 秒，就会把 <code>redo log buffer</code> 中的内容写到文件系统缓存（<code>page cache</code>），然后调用 <code>fsync</code> 刷盘。</p>
<p>所以，无事务提交的redo log，也可能刷盘。</p>
<p><img src="https://oss.javaguide.cn/github/javaguide/05.png" alt="img"></p>
<h3 id="日志文件组"><a href="#日志文件组" class="headerlink" title="日志文件组"></a>日志文件组</h3><p>redo log日志文件不止一个，是以日志文件组形式存在，每个redo日志文件大小一样。</p>
<p>采用环形数组形式，从头开始写，写到末尾又回头循环写。</p>
<img src="https://oss.javaguide.cn/github/javaguide/10.png" alt="img" style="zoom:50%;" />

<p>日志文件组两个重要属性：</p>
<ul>
<li><p><strong>write pos</strong>：当前记录的位置，一边写一边后移。</p>
<p>刷盘记录redo log到日志文件组时，write pos后移更新。</p>
</li>
<li><p><strong>checkpoint</strong>：当前要擦除的位置，也是往后推移</p>
<p>MySQL加载日志文件组恢复数据时，会清空加载过的redo log，checkpoint后移更新。</p>
</li>
</ul>
<p><strong>write pos 追上checkpoint?</strong></p>
<p>表示日志文件组已满，不能再写入新的redo log，MySQL阻塞，将Buffer Pool中脏页刷新进磁盘，然后标记redo log可以擦除的记录，并擦除，推进checkpoint.</p>
<p><strong>注</strong>：MySQL 8.0.30 之前可以通过 <code>innodb_log_files_in_group</code> 和 <code>innodb_log_file_size</code> 配置日志文件组的文件数和文件大小，但在 MySQL 8.0.30 及之后的版本中，这两个变量已被废弃，即使被指定也是用来计算 <code>innodb_redo_log_capacity</code> 的值。而日志文件组的文件数则固定为 32，文件大小则为 <code>innodb_redo_log_capacity / 32</code> 。</p>
<p>在使用 MySQL 8.0.30 及之后的版本时，推荐使用 <code>innodb_redo_log_capacity</code> 变量配置日志文件组</p>
<h2 id="binlog归档日志"><a href="#binlog归档日志" class="headerlink" title="binlog归档日志"></a>binlog归档日志</h2><p>作用：记录更新语句的原始逻辑，是逻辑日志，属于MySQL Server层。</p>
<p>不管用什么存储引擎，只要发生了表数据更新，都会产生 <code>binlog</code> 日志。</p>
<p><code>MySQL</code>数据库的<strong>数据备份、主备、主主、主从</strong>都离不开<code>binlog</code>，需要依靠<code>binlog</code>来同步数据，保证数据一致性。</p>
<p><code>binlog</code>会记录所有涉及<strong>更新数据的逻辑操作</strong>，并且是顺序写。</p>
<h3 id="记录格式"><a href="#记录格式" class="headerlink" title="记录格式"></a>记录格式</h3><p>有3种格式，可通过<code>binlog_format</code>参数指定：</p>
<ul>
<li><p><strong>statement</strong>：记录SQL语句原文。</p>
<p>同步数据时，会执行记录的SQL语句。</p>
<p>问题：更新的字段为当前时间<code>now()</code>时，同步执行会与源库时间不一致。</p>
<p>解决：指定row</p>
</li>
<li><p><strong>row</strong>：除简单SQL外，还包含操作的具体数据。</p>
<p>看不到详细信息，需通过<code>mysqlbinlog</code>工具解析。</p>
<p>优点：可以保证同步数据的一致性。【通常都用】</p>
<p>缺点：占用空间较大，恢复与同步更消耗IO资源，影响执行速度。</p>
<p>解决：折中方案，mixed.</p>
</li>
<li><p><strong>mixed</strong>：MySQL判断SQL语句是否可能引起数据不一致，会则使用<code>row</code>，不会则使用<code>statement</code>。</p>
</li>
</ul>
<h3 id="写入机制"><a href="#写入机制" class="headerlink" title="写入机制"></a>写入机制</h3><ol>
<li><p>事务执行过程中，先将日志写入到<code>binlog cache</code></p>
</li>
<li><p>事务<strong>提交</strong>时，将<code>binlog cache</code>写入到<code>binlog</code>文件中。（追加写，写满换新文件）</p>
<blockquote>
<ol>
<li>先write到文件系统的page cache，速度快</li>
<li>再fsync，持久化到磁盘</li>
</ol>
<p><strong>write和fsync的时机</strong>：由参数<code>sync_binlog</code>控制</p>
<ul>
<li><p><strong>0</strong>：每次提交事务只write，由系统判断什么时候fsync（默认）</p>
<p>优点：性能得到提升</p>
<p>缺点：机器宕机，page cache中的binlog会丢失</p>
</li>
<li><p><strong>1</strong>：每次提交事务都执行fsync</p>
</li>
<li><p><strong>N</strong>：N &gt; 1，即每次提交事务都write，累积N个事务后fsync</p>
<p>优点：出现IO瓶颈时，放大N，可以提升性能</p>
<p>缺点：机器宕机后，会丢失最近的N个事务的binlog</p>
</li>
</ul>
</blockquote>
</li>
</ol>
<p>因为一个事务的<code>binlog</code>不能被拆开，无论这个事务多大，也要确保一次性写入，所以系统会给每个线程分配一个块内存作为<code>binlog cache</code>。</p>
<h3 id="主从复制实现"><a href="#主从复制实现" class="headerlink" title="主从复制实现"></a>主从复制实现</h3><p><img src="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202401071355262.png" alt="img"></p>
<p>主从复制过程一般是异步的。过程一般有3个阶段：</p>
<ol>
<li>写入binlog[主库]</li>
<li>同步binlog[从库创建线程连接主库的log dump线程，复制到从库，写到暂存日志relay log]</li>
<li>回放binlog[从库，回放更新]</li>
</ol>
<p>完成主从复制后，可以实现：</p>
<ul>
<li><strong>写数据：只写主库</strong></li>
<li><strong>读数据：只读从库</strong></li>
</ul>
<p>从而，写请求锁表时，不会影响读请求执行。</p>
<p><strong>Q：从库数量越多越好？</strong></p>
<p><strong>A</strong>：No. 从库数量多，其连接上来的IO线程也多，主库需要创建同样数量的log dump线程来处理复制请求，对主库的资源消耗量高。</p>
<p>一般，一个主库一般跟 2～3 个从库（1 套数据库，1 主 2 从 1 备主）</p>
<h2 id="两阶段提交"><a href="#两阶段提交" class="headerlink" title="两阶段提交"></a>两阶段提交</h2><p>redo log：使InnoDB有了崩溃恢复的能力</p>
<p>binlog：保证了MySQL集群架构的数据一致性</p>
<p>两个的写入时机：</p>
<ul>
<li>redo log：事务<strong>执行过程中</strong>可以不断写入</li>
<li>binlog：<strong>提交事务时</strong>写入</li>
</ul>
<img src="https://oss.javaguide.cn/github/javaguide/01-20220305234816065.png" alt="img" style="zoom:50%;" />

<p><strong>Q：redo log 与 binlog之间的逻辑不一致会造成的问题？</strong></p>
<p><strong>A</strong>：假设场景为：redo log写完后，在写binlog的过程中出现异常</p>
<pre><code>   则会导致：redo log 与 binlog中的数据不一致。即会导致恢复时，主备 / 从库数据不一致。
</code></pre>
<p>解决方案：InnoDB使用<strong>两阶段提交</strong>方案。</p>
<p>原理：将redo log的写入拆分为两个步骤：</p>
<ol>
<li>prepare</li>
<li>commit</li>
</ol>
<img src="https://oss.javaguide.cn/github/javaguide/04-20220305234956774.png" alt="img" style="zoom:50%;" />

<p>此时若发生binlog写入异常：</p>
<p>Mysql根据redo log恢复数据时，发现redo log还处于prepare阶段，且无对应的binlog日志，就会回滚事务。</p>
<p><strong>Q：redo log commit阶段发生异常，会回滚事务吗？</strong></p>
<p><strong>A</strong>：不会，redo log虽然处于prepare截断，但是可以通过事务id找到对应的binlog日志，所以MySQL认为是完整的，会提交事务恢复数据。</p>
<h2 id="undo-log回滚日志"><a href="#undo-log回滚日志" class="headerlink" title="undo log回滚日志"></a>undo log回滚日志</h2><p>想要保证事务的<strong>原子性（Atomicity）</strong>：异常发生时，对已执行的操作进行回滚。</p>
<p>作用：事务还未执行完（未提交），发生故障，需要回滚到事务之前的数据。即保证事务原子性。此外，还是实现MVCC的关键因素之一。</p>
<p>记录时机：事务未提交前，记录更新前的数据到undo log中。</p>
<p>如（不同类型操作undo log的格式不同）：</p>
<ul>
<li><p>插入记录时，记录主键，回滚时删除对应记录</p>
</li>
<li><p>删除记录时，记录所有内容，回滚时插入对应记录</p>
</li>
<li><p>更新记录时，记录旧值与主键，回滚时更新为旧值</p>
<blockquote>
<p>更新操作产生的undo log都有一个roll_pointer指针和一个trx_id（事务id）：</p>
<ul>
<li>trx_id：记录被哪个事务修改的</li>
<li>roll_pointer：将undo log串成一个链表，即版本链</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="undo-log刷盘"><a href="#undo-log刷盘" class="headerlink" title="undo log刷盘"></a>undo log刷盘</h3><p>与数据页的刷盘策略一致，需通过redo log保证持久化。</p>
<p>Buffer Pool中有undo页，对undo 页的修改会记录到redo log， redo log再刷盘。</p>
<h1 id="MCVV"><a href="#MCVV" class="headerlink" title="MCVV"></a>MCVV</h1><p>MVCC: Multi-Version Concurrency Control，即多版本并发控制。</p>
<p>作用：保证多并发事务同时读写数据库时数据的一致性和隔离性。</p>
<p>实现方式：在每个数据行上维护多个版本的数据。当一个事务要对数据库中数据进行修改时，MVCC会为其创建一个数据快照，而不直接修改实际的数据行。</p>
<h2 id="快照读-vs-当前读"><a href="#快照读-vs-当前读" class="headerlink" title="快照读 vs. 当前读"></a>快照读 vs. 当前读</h2><p><strong>快照读</strong></p>
<p>不加锁的非阻塞读。</p>
<p>读取数据的某个版本快照。普通select即为快照读。</p>
<p><strong>当前读</strong></p>
<p>读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。</p>
<p>select lock in share mode(共享锁), select for update ; update, insert ,delete(排他锁)都是当前读。</p>
<p><strong>1. 读操作</strong></p>
<p>使用快照读。</p>
<p>快照读基于事务开始时数据库中的状态创建，因此事务不会读取其他事务尚未提交的修改。</p>
<p>具体操作如下：</p>
<ul>
<li>事务查找符合条件的数据行，并选择符合事务开始时间的数据版本进行读取。</li>
<li>某个数据行有多个版本时：事务会选择不晚于其开始时间的最新版本。确保事务只读在其开始前已存在的数据。</li>
<li>事务读取的是快照数据，因此其他并发事务对数据行的修改不影响当前读取。</li>
</ul>
<p><strong>2. 写操作</strong></p>
<p>会生成新的数据版本，并将修改后的数据写入数据库。</p>
<p>具体操作如下：</p>
<ul>
<li>事务为要修改的数据行创建一个新的版本，并将修改后的数据写入新版本。</li>
<li>新版本的数据会带有当前事务的版本号，以便其他事务能够正确读取相应版本的数据。</li>
<li>原始版本的数据仍然存在，供其他事务使用快照读取，这保证了其他事务不受当前事务的写操作影响。</li>
</ul>
<p><strong>3. 事务的提交与回滚</strong></p>
<ul>
<li>当一个事务提交时，它所做的修改将成为数据库的最新版本，并且对其他事务可见。</li>
<li>当一个事务回滚时，它所做的修改将被撤销，对其他事务不可见。</li>
</ul>
<p><strong>4. 版本的回收</strong></p>
<p>为了防止数据库中的版本无限增长，MVCC 会定期进行版本的回收。回收机制会删除已经不再需要的旧版本数据，从而释放空间。</p>
<p>MVCC 通过创建数据的多个版本和使用快照读取来实现并发控制。读操作使用旧版本数据的快照，写操作创建新版本，并确保原始版本仍然可用。这样，不同的事务可以在一定程度上并发执行，而不会相互干扰，从而提高了数据库的并发性能和数据一致性。</p>
<h2 id="InnoDB对MVCC的实现"><a href="#InnoDB对MVCC的实现" class="headerlink" title="InnoDB对MVCC的实现"></a>InnoDB对MVCC的实现</h2><p><code>MVCC</code> 的实现依赖于：<strong>隐藏字段、Read View、undo log</strong>。</p>
<p>在内部实现中，</p>
<ol>
<li><p><code>InnoDB</code> 通过数据行的 <code>DB_TRX_ID</code> 和 <code>Read View</code> 来判断数据的可见性，</p>
</li>
<li><p>如不可见，则通过数据行的 <code>DB_ROLL_PTR</code> 找到 <code>undo log</code> 中的历史版本。</p>
<p>每个事务读到的数据版本可能是不一样的，在同一个事务中，用户只能看到该事务<u>创建 <code>Read View</code> 之前</u>已经提交的修改和该事务本身做的修改。</p>
</li>
</ol>
<h3 id="隐藏字段"><a href="#隐藏字段" class="headerlink" title="隐藏字段"></a>隐藏字段</h3><p>InnoDB为每行数据添加三个隐藏字段：</p>
<ul>
<li><p><code>DB_TRX_ID（6字节）</code>：即事务ID，表示最后一次插入或更新该行的事务 id。</p>
<p>此外，<code>delete</code> 操作在内部被视为更新，只不过会在记录头 <code>Record header</code> 中的 <code>deleted_flag</code> 字段将其标记为已删除</p>
</li>
<li><p><code>DB_ROLL_PTR（7字节）</code>： 回滚指针，指向该行的 <code>undo log</code> 。</p>
<p>如果该行未被更新，则为空</p>
</li>
<li><p><code>DB_ROW_ID（6字节）</code>：即隐式主键，如果没有设置主键且该表没有唯一非空索引时，<code>InnoDB</code> 会使用该 id 来生成聚簇索引</p>
</li>
</ul>
<h3 id="ReadView"><a href="#ReadView" class="headerlink" title="ReadView"></a>ReadView</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadView</span> &#123;</span></span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">private:</span><br><span class="line">  <span class="type">trx_id_t</span> m_low_limit_id;      <span class="comment">/* 目前出现过的最大的事务 ID+1，即下一个将被分配的事务 ID。大于等于这个 ID 的事务均不可见 */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">trx_id_t</span> m_up_limit_id;       <span class="comment">/* 活跃事务列表 m_ids 中最小的事务 ID，如果 m_ids 为空，则 m_up_limit_id 为 m_low_limit_id。小于这个 ID 的事务均可见 */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">trx_id_t</span> m_creator_trx_id;    <span class="comment">/* 创建该 Read View 的事务ID */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">trx_id_t</span> m_low_limit_no;      <span class="comment">/* 事务 Number, 小于该 Number 的 Undo Logs 均可以被 Purge(清除) */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">ids_t</span> m_ids;                  <span class="comment">/* 创建 Read View 时的活跃事务列表 */</span></span><br><span class="line"></span><br><span class="line">  m_closed;                     <span class="comment">/* 标记 Read View 是否 close */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Read View即为事务进行快照读时产生的读视图。</p>
<p>作用：主要是用于做<strong>可见性判断</strong>。当某个事务执行快照读时，会对该记录创建一个read view，将其作为条件用于判断当前事务能看到哪个版本的数据。</p>
<h4 id="可见性算法"><a href="#可见性算法" class="headerlink" title="可见性算法"></a>可见性算法</h4><p><strong>注</strong>：</p>
<ol>
<li>ReadView与SQL绑定，而非与事务绑定。所以即使在同一事务中，每次SQL启动时的<code>low_trx_id</code>和<code>up_trx_id</code>也是不同。</li>
<li><code>db_trx_id</code>指的是数据行中的<code>db_trx_id</code>字段，分配的事务ID只有操作了数据行，才会更新该字段值。（越晚创建id越大）</li>
</ol>
<p><strong>up_limit_id</strong></p>
<p>表示“低水位”，即当前活跃事务列表的最小事务id(最早创建的事务)，若读取的数据行上的<code>db_trx_id</code>小于<code>up_limit_id</code>，表明这条记录的最后修改在readview创建之前，因此这条记录可以被看见。</p>
<p><strong>low_limit_id</strong></p>
<p>表示“高水位”，即当前活跃事务的最大id(最晚创建的事务) + 1，若读取的数据行上的<code>db_trx_id</code>大于<code>lpw_limit_id</code>，表明这条记录的最后修改在readview创建之后，因此这条记录不可以被看见。</p>
<p>若读取的数据行上的<code>db_trx_id</code>在<code>up_limit_id</code>与<code>low_limit_id</code>之间，则查找该数据行上的<code>db_trx_id</code>是否在ReadView上的<code>m_ids</code>列表中。（即该事务是否为活跃事务）</p>
<ul>
<li>在其中，说明该条记录的最后修改在ReadView创建之时，被另一个活跃事务所修改，所以该条记录不可见。</li>
<li>不在其中，说明该条记录的最后修改在ReadView之后，所以可见。</li>
</ul>
<p>综合以上，可见性算法的流程为：</p>
<p><img src="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202401071355068.png" alt="可见性算法"></p>
<h4 id="ReadView生成时机"><a href="#ReadView生成时机" class="headerlink" title="ReadView生成时机"></a>ReadView生成时机</h4><p><strong>1. RR（Repeatable Read）</strong></p>
<ul>
<li>每个事务执行<code>SELECT</code>语句时：<ul>
<li><strong>首次</strong>执行：会讲当前系统所有活跃事务拷贝到一个列表中生成ReadView</li>
<li><strong>后续</strong>执行：复用其之前生成的ReadView</li>
</ul>
</li>
<li><code>UPDATE, DELETE, INSERT</code>：对一致性读snapshot无影响</li>
</ul>
<p>RR隔离级别，第一次创建ReadView后，其就会一直持续到事务结束。</p>
<p>即在事务执行过程中，数据的可见性不会变，所以在事务内部不会出现数据不一致的情况。</p>
<p><strong>2. RC（Read Commited)</strong></p>
<ul>
<li><strong>每次</strong><code>SELECT</code>执行，都会重新将当前系统中的所有活跃事务拷贝到一个列表中生成ReadView</li>
</ul>
<p>问题：两个查询之间有事务提交，就会出现数据不一致。</p>
<h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h3><p>InnoDB有两种undo log：</p>
<ul>
<li><p><strong>insert undo log</strong>：指在 <code>insert</code> 操作中产生的 <code>undo log</code>。</p>
<p>因为 <code>insert</code> 操作的记录只对事务本身可见，对其他事务不可见。只在事务回滚时需要，故该 <code>undo log</code> 可以<strong>在事务提交后直接删除</strong>。不需要进行 <code>purge</code> 操作</p>
</li>
<li><p><strong>update undo log</strong>：<code>update</code> 或 <code>delete</code> 操作中产生的 <code>undo log</code>。</p>
<p>除事务回滚需要之外，可能需要提供 <code>MVCC</code> 机制，因此不能在事务提交时就进行删除。提交时放入 <code>undo log</code> 链表，等待 <code>purge线程</code> 进行最后的删除</p>
</li>
</ul>
<p>不同事务或者相同事务的对同一记录行的修改，会使该记录行的 <code>undo log</code> 成为一条链表，链首就是最新的记录，链尾就是最早的旧记录。</p>
<h2 id="purge"><a href="#purge" class="headerlink" title="purge"></a>purge</h2><ul>
<li>为实现MVCC，更新或删除操作都是：设置一下老记录的<code>deleted_bit</code>，并不是真的删除。</li>
<li>为节省磁盘空间，InnoDB有专门的purge线程来清理<code>deleted_bit</code>为<code>true</code>的记录。</li>
<li>为不影响MVCC正常工作，purge线程自己也维护了一个read view(相当于系统中最老活跃事务的read view)</li>
<li>若某个记录的<code>deleted_bit</code>为<code>true</code>，且<code>DB_TRX_ID</code>相对于purge线程的read view可见，这条记录一定时可以被安全清除的。</li>
</ul>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wtopps/article/details/118247884">什么是MySQL MVCC的ReadView？</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jelly12345/p/14889331.html">MVCC多版本并发控制原理总结（最终版）</a></p>

      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/0.html" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-17 19:14:29" itemprop="dateCreated datePublished" datetime="2023-12-17T19:14:29+08:00">2023-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-31 17:54:08" itemprop="dateModified" datetime="2024-01-31T17:54:08+08:00">2024-01-31</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/0.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>15</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MyBatisPlus"><a href="#MyBatisPlus" class="headerlink" title="MyBatisPlus"></a>MyBatisPlus</h1><h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2>
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mooyi646.github.io/post/cbb39f4b.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
      <meta itemprop="name" content="Mooyi">
      <meta itemprop="description" content="Live with fun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mooyi's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/post/cbb39f4b.html" class="post-title-link" itemprop="url">Helm</a>
        </h2>

        <div class="post-meta">

        
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-12-13 19:16:00 / Modified: 19:18:16" itemprop="dateCreated datePublished" datetime="2023-12-13T19:16:00+08:00">2023-12-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learning/" itemprop="url" rel="index"><span itemprop="name">Learning</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learning/K8S/" itemprop="url" rel="index"><span itemprop="name">K8S</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/cbb39f4b.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/cbb39f4b.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h1><h2 id="0-概述"><a href="#0-概述" class="headerlink" title="0 概述"></a>0 概述</h2><p><strong>为什么使用Helm?</strong></p>
<p>K8s能够很好地组织和编排容器，但是缺少一个更高层次的应用打包工具。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/post/cbb39f4b.html#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mooyi"
      src="https://raw.githubusercontent.com/Mooyi646/ImageSaver/main/202309281528071.png">
  <p class="site-author-name" itemprop="name">Mooyi</p>
  <div class="site-description" itemprop="description">Live with fun</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Mooyi646" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Mooyi646" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/mooyixh@gmail.com" title="E-Mail → mooyixh@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/LuoMooyi" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;LuoMooyi" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/m00y1h" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;m00y1h" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="Link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://google.com/" title="http:&#x2F;&#x2F;google.com" rel="noopener" target="_blank">Google</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bing.com/" title="http:&#x2F;&#x2F;bing.com" rel="noopener" target="_blank">Bing</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-07 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mooyi</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">152k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">2:19</span>
</div>

<!--
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mooyi.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
